<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Cary"><meta name="keywords" content="个人博客"><meta name="description" conauthortent="若尧的博客"><link rel="alternative" href="/atom.xml" title="若尧" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>react-navigation的用法 - 若尧</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0;"><div class="hide" id="particles-oli-wrapper"></div><header class="head"><h1 class="head-title u-fl"><a href="/">若尧</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">目录</a></li><li class="head-nav__item"><a class="head-nav__link" href="/about">关于</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-02-01T06:39:50.000Z">二月 1, 2018</time><h1 class="post__title"><a href="/2018/02/01/react-native-02/">react-navigation的用法</a></h1><div class="post__main echo"><p>(1)<a href="https://reactnavigation.org" target="_blank" rel="noopener">官方网站</a><br>(2)<a href="https://www.jianshu.com/p/2f575cc35780" target="_blank" rel="noopener">参考资料</a></p>
<h3 id="1-基本类型"><a href="#1-基本类型" class="headerlink" title="1.基本类型"></a>1.基本类型</h3><p>react-navigation分为三个部分。<br>StackNavigator类似顶部导航条，用来跳转页面和传递参数。<br>TabNavigator类似底部标签栏，用来区分模块。<br>DrawerNavigator抽屉，类似从App左侧滑出一个页面，在这里不做讲解。</p>
<h3 id="2-screenProps"><a href="#2-screenProps" class="headerlink" title="2.screenProps"></a>2.screenProps</h3><p>screenProps：react-navigation自带的一个属性，属于navigationOptions的一个属性，可以全局控制navigationOptions中的某些值，比如说你想做换肤功能，修改这个属性绝对是最简单的方式。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 假设App就是项目中的入口文件，如果还不知道，可以看下Demo，在这里我将主题色通过screenProps属性修改成'red'</span><br><span class="line"><span class="tag">&lt;<span class="name">App</span> <span class="attr">screenProps</span>=<span class="string">&#123;&#123;themeColor:</span>'<span class="attr">red</span>'&#125;&#125;&gt;</span></span><br><span class="line"></span><br><span class="line">// 在页面中就可以通过screenProps来直接改变了，这个在Demo中的Test2里面</span><br><span class="line"></span><br><span class="line">static navigationOptions = (&#123;navigation,screenProps&#125;) =&gt; (&#123;</span><br><span class="line">        // 这里面的属性和App.js的navigationOptions是一样的。</span><br><span class="line">		headerStyle:&#123;backgroundColor:screenProps?</span><br><span class="line">		screenProps.themeColor:</span><br><span class="line">		'#4ECBFC'&#125;,</span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="3-TabNavigator"><a href="#3-TabNavigator" class="headerlink" title="3.TabNavigator"></a>3.TabNavigator</h3><p>安卓下用作底部导航栏显示图标需要配置：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	tabBarPosition: <span class="string">'bottom'</span>,</span><br><span class="line">	animationEnabled: <span class="literal">true</span>,</span><br><span class="line">	configureTransition: <span class="function">(<span class="params">currentTransitionProps,nextTransitionProps</span>) =&gt;</span> (&#123;</span><br><span class="line">		timing: Animated.spring,</span><br><span class="line">		tension: <span class="number">1</span>,</span><br><span class="line">		friction: <span class="number">35</span>,</span><br><span class="line">	&#125;),</span><br><span class="line">	swipeEnabled: <span class="literal">true</span>,</span><br><span class="line">	tabBarOptions: &#123;</span><br><span class="line">		showIcon: <span class="literal">true</span>  <span class="comment">//android下默认不显示图标</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="4-自定义导航栏"><a href="#4-自定义导航栏" class="headerlink" title="4.自定义导航栏"></a>4.自定义导航栏</h3><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> StackOptions = <span class="function">(<span class="params">&#123;navigation&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(navigation);</span><br><span class="line">    <span class="keyword">let</span> &#123;state,goBack&#125; = navigation;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用来判断是否隐藏或显示header</span></span><br><span class="line">    <span class="keyword">const</span> visible= state.params.isVisible;</span><br><span class="line">    <span class="keyword">let</span> header;</span><br><span class="line">    <span class="keyword">if</span> (visible === <span class="literal">true</span>)&#123;</span><br><span class="line">        header = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> headerStyle = &#123;<span class="attr">backgroundColor</span>:<span class="string">'#4ECBFC'</span>&#125;;</span><br><span class="line">    <span class="keyword">const</span> headerTitle = state.params.title;</span><br><span class="line">    <span class="keyword">const</span> headerTitleStyle = &#123;<span class="attr">fontSize</span>:FONT_SIZE(<span class="number">20</span>),<span class="attr">color</span>:<span class="string">'white'</span>,<span class="attr">fontWeight</span>:<span class="string">'500'</span>&#125;</span><br><span class="line">    <span class="keyword">const</span> headerBackTitle = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">const</span> headerLeft = (</span><br><span class="line">        &lt;Button</span><br><span class="line">            isCustom=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">            customView=&#123;</span><br><span class="line">                            &lt;Icon</span><br><span class="line">                                name=<span class="string">'ios-arrow-back'</span></span><br><span class="line">                                size=&#123;<span class="number">30</span>&#125;</span><br><span class="line">                                color=<span class="string">'white'</span></span><br><span class="line">                                style=&#123;&#123;<span class="attr">marginLeft</span>:<span class="number">13</span>&#125;&#125;</span><br><span class="line">                            /&gt;</span><br><span class="line">                        &#125;</span><br><span class="line">            onPress=&#123;()=&gt;&#123;goBack()&#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> &#123;headerStyle,headerTitle,headerTitleStyle,headerBackTitle,headerLeft,header&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用：<br><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MyApp = StackNavigator(&#123;</span><br><span class="line">    MyTab: &#123;</span><br><span class="line">        screen: MyTab,</span><br><span class="line">    &#125;,</span><br><span class="line">    Detail: &#123;</span><br><span class="line">        screen: Detail,</span><br><span class="line">        navigationOptions: <span class="function">(<span class="params">&#123;navigation&#125;</span>) =&gt;</span> StackOptions(&#123;navigation&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="5-二级界面隐藏Tabbar"><a href="#5-二级界面隐藏Tabbar" class="headerlink" title="5.二级界面隐藏Tabbar"></a>5.二级界面隐藏Tabbar</h3><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UserTab = StackNavigator(&#123;</span><br><span class="line">	UserCenter: &#123;</span><br><span class="line">		screen: <span class="function">(<span class="params">&#123; navigation &#125;</span>) =&gt;</span> (<span class="xml"><span class="tag">&lt;<span class="name">UserCenter</span> <span class="attr">navigation</span>=<span class="string">&#123;navigation&#125;</span> /&gt;</span>),</span></span><br><span class="line"><span class="xml">		path: '/userCenter',</span></span><br><span class="line"><span class="xml">		navigationOptions: &#123;</span></span><br><span class="line"><span class="xml">			headerTitle: '个人中心',</span></span><br><span class="line"><span class="xml">			headerTintColor: Color.while,</span></span><br><span class="line"><span class="xml">			headerStyle: styles.headerBg</span></span><br><span class="line"><span class="xml">		&#125;,</span></span><br><span class="line"><span class="xml">	&#125;,</span></span><br><span class="line"><span class="xml">	Login: &#123;</span></span><br><span class="line">		screen: (&#123; navigation &#125;) =&gt; (&lt;Login navigation=&#123;navigation&#125; /&gt;),</span><br><span class="line">		path: '/login',</span><br><span class="line">		navigationOptions: &#123;</span><br><span class="line">			header: (&#123; navigation &#125;)=&gt;(&lt;ComHeader navigation=&#123;navigation&#125; title="登陆"/&gt;),</span><br><span class="line">			tabBarVisible: false //隐藏tabbar</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="6-error-Invariant-Violation：view-config-not-found-for-name-hotGroups"><a href="#6-error-Invariant-Violation：view-config-not-found-for-name-hotGroups" class="headerlink" title="6.error: Invariant Violation：view config not found for name hotGroups"></a>6.error: Invariant Violation：view config not found for name hotGroups</h3><p>好像是没找到navigation。<br>感觉navigation的使用不太对，只能一层层传过去。<br><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> GroupTab = TabNavigator(</span><br><span class="line">	&#123;</span><br><span class="line">		hotGroups: &#123;</span><br><span class="line">			screen: <span class="function">(<span class="params">&#123; navigation&#125;</span>) =&gt;</span> (<span class="xml"><span class="tag">&lt;<span class="name">hotGroups</span> <span class="attr">navigation</span>=<span class="string">&#123;navigation&#125;</span> /&gt;</span>),</span></span><br><span class="line"><span class="xml">			path: '/hotGroups',</span></span><br><span class="line"><span class="xml">			navigationOptions: &#123;</span></span><br><span class="line"><span class="xml">				tabBarLabel: '推荐社群'</span></span><br><span class="line"><span class="xml">			&#125;,</span></span><br><span class="line"><span class="xml">		&#125;,</span></span><br><span class="line"><span class="xml">		myGroups: &#123;</span></span><br><span class="line">			screen: (&#123; navigation&#125;) =&gt; (&lt;myGroups navigation=&#123;navigation&#125; /&gt;),</span><br><span class="line">			path: '/myGroups',</span><br><span class="line">			navigationOptions: &#123;</span><br><span class="line">				tabBarLabel: '我的社群'</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		tabBarPosition: 'top',</span><br><span class="line">		animationEnabled: true,</span><br><span class="line">		configureTransition: (currentTransitionProps,nextTransitionProps) =&gt; (&#123;</span><br><span class="line">			timing: Animated.spring,</span><br><span class="line">			tension: 1,</span><br><span class="line">			friction: 35,</span><br><span class="line">		&#125;),</span><br><span class="line">		swipeEnabled: false,</span><br><span class="line">		tabBarOptions: &#123;</span><br><span class="line">			activeTintColor: Color.while,</span><br><span class="line">			labelStyle: &#123;</span><br><span class="line">				fontSize: 16</span><br><span class="line">			&#125;,</span><br><span class="line">			style: &#123;</span><br><span class="line">				backgroundColor: Color.main</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="7-实现replace方法"><a href="#7-实现replace方法" class="headerlink" title="7.实现replace方法"></a>7.实现replace方法</h3><p>由于新版的react navigation似乎没有了replace方法，只能reset所有路由。<br>翻阅各种issues，找到一种可以用的方法：<br><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//routes.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; StackNavigator &#125; <span class="keyword">from</span> <span class="string">'react-navigation'</span>;</span><br><span class="line"><span class="keyword">const</span> HomeStack = StackNavigator(</span><br><span class="line">	&#123;</span><br><span class="line">		Web: &#123; <span class="attr">screen</span>: XXX, <span class="attr">path</span>: <span class="string">'/'</span> &#125;,</span><br><span class="line">		Login: &#123; <span class="attr">screen</span>: XXX1 &#125;,</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//思路在于dispath一个type为replace的action，在原getStateForAction方法上重写</span></span><br><span class="line"><span class="keyword">const</span> prevGetStateForAction = HomeStack.router.getStateForAction;</span><br><span class="line">HomeStack.router.getStateForAction = <span class="function">(<span class="params">action, state</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (state &amp;&amp; action.type === <span class="string">"replace"</span>) &#123;</span><br><span class="line">		<span class="keyword">const</span> routes = state.routes.slice(<span class="number">0</span>, state.routes.length - <span class="number">1</span>);</span><br><span class="line">		action.key =  <span class="string">`id-<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>-<span class="subst">$&#123;routes.length - <span class="number">1</span>&#125;</span>`</span>;</span><br><span class="line">		routes.push(action);</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			...state,</span><br><span class="line">			routes,</span><br><span class="line">			index: routes.length - <span class="number">1</span></span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> prevGetStateForAction(action, state);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//XXX.js 页面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.props.navigation.dispatch(&#123;</span><br><span class="line">	type: <span class="string">'replace'</span>,</span><br><span class="line">	routeName: <span class="string">'Login'</span>,</span><br><span class="line">	key: <span class="string">'Login'</span>,</span><br><span class="line">	params: &#123;</span><br><span class="line">		id: <span class="number">123</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/react-navigation/react-navigation/issues/802" target="_blank" rel="noopener">参考</a></p>
<h3 id="8-lazy"><a href="#8-lazy" class="headerlink" title="8.lazy"></a>8.lazy</h3><p>v1.0.0-beta.23 has a breaking change noted: “Drop the lazy option for TabNavigator”<br>lazy属性用不了，TabNavigator会一次性全部加载</p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/react/">react</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/react-native/">react-native</a></li></ul></footer></article><link rel="stylesheet" href="/css/menu.css"><script src="/js/jquery.autoMenu.js"></script><div class="autoMenu" id="autoMenu" data-autoMenu></div><section class="reward"> <a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechatImage.jpg" title="微信"><img src="/img/alipayImage.jpg" title="支付宝"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 Cary</div></footer><!--include ../plugins/google.pug--><script src="/js/particles.min.js"></script><script src="/js/particles.other.js"></script><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>