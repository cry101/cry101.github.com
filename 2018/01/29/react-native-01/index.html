<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Cary"><meta name="keywords" content="个人博客"><meta name="description" conauthortent="若尧的博客"><link rel="alternative" href="/atom.xml" title="若尧" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>react-native踩坑中 - 若尧</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0;"><div class="hide" id="particles-oli-wrapper"></div><header class="head"><h1 class="head-title u-fl"><a href="/">若尧</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">目录</a></li><li class="head-nav__item"><a class="head-nav__link" href="/about">关于</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-01-29T07:19:43.000Z">一月 29, 2018</time><h1 class="post__title"><a href="/2018/01/29/react-native-01/">react-native踩坑中</a></h1><div class="post__main echo"><h3 id="1-react相关注意点"><a href="#1-react相关注意点" class="headerlink" title="1.react相关注意点"></a>1.react相关注意点</h3><p>（1）超过最大更新深度<br>error<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Maximum update depth exceeded. </span><br><span class="line">This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. </span><br><span class="line">React limits the number of nested updates to prevent infinite loops.</span><br></pre></td></tr></table></figure></p>
<p>(2)弃用PropTypes<br><a href="http://www.css88.com/react/docs/typechecking-with-proptypes.html" target="_blank" rel="noopener">文档</a><br>从 React v15.5 开始 ，React.PropTypes 助手函数已被弃用，我们建议使用 <a href="https://github.com/facebook/prop-types" target="_blank" rel="noopener">prop-types</a> 库 来定义contextTypes。</p>
<h3 id="2-配置极光推送"><a href="#2-配置极光推送" class="headerlink" title="2.配置极光推送"></a>2.配置极光推送</h3><p><a href="https://github.com/jpush/jpush-react-native" target="_blank" rel="noopener">官方插件</a><br>注：<br>（1）在项目的AndroidManifest.xml里面加上下面代码,注意下protectionLevel，这里是权限保护设置。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--添加通知权限，$&#123;ApplicationID&#125;替换成你的applicationID!--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">premission</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"$&#123;ApplicationID&#125;.permission.JPUSH_MESSAGE"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:protectionLevel</span>=<span class="string">"signature"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>（2）打开node_modules/jpush_react-native/android/src/AndroidManifest.xml，将所有的${applicationId}替换成你的包名。<br>或者通过android studio打开找到jpush_react-native项目下的AndroidManifest.xml。</p>
<p>(3) error:<br>Undefined is no a function evaluating cb(resultCode)</p>
<h3 id="3-配置iconfont"><a href="#3-配置iconfont" class="headerlink" title="3.配置iconfont"></a>3.配置iconfont</h3><p><a href="https://www.jianshu.com/p/96d5c66791c3" target="_blank" rel="noopener">配置阿里下载的iconfont</a></p>
<h3 id="4-run-ios闪退"><a href="#4-run-ios闪退" class="headerlink" title="4.run-ios闪退"></a>4.run-ios闪退</h3><p>用Xcode直接编译运行没有问题，<br>利用终端命令react-native run-ios 出现闪退问题。</p>
<p>解决方案：由于我使用翻墙软件，造成localhost不能识别本地ip。只需要退出翻墙软件即可正常运行。</p>
<h3 id="5-redux的使用"><a href="#5-redux的使用" class="headerlink" title="5.redux的使用"></a>5.redux的使用</h3><p><a href="https://www.jianshu.com/p/2c43860b0532" target="_blank" rel="noopener">参考</a><br>step1： //root.js<br><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import react-native</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react-native'</span></span><br><span class="line"><span class="comment">// same for react-redux</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> configureStore <span class="keyword">from</span> <span class="string">'./store/configure-store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./containers/app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = configureStore()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Root</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &#123;() =&gt; <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Root</span><br></pre></td></tr></table></figure></p>
<p>step2:<br><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react-native'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  AppRegistry</span><br><span class="line">&#125; = React</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Root <span class="keyword">from</span> <span class="string">'./root'</span></span><br><span class="line"></span><br><span class="line">AppRegistry.registerComponent(<span class="string">'soundreduxNative'</span>, () =&gt; Root)</span><br></pre></td></tr></table></figure></p>
<h3 id="6-redux-persist-数据持久化"><a href="#6-redux-persist-数据持久化" class="headerlink" title="6.redux-persist(数据持久化)"></a>6.redux-persist(数据持久化)</h3><p><a href="https://github.com/rt2zz/redux-persist" target="_blank" rel="noopener">官方文档</a><br><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//store.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; applyMiddleware, createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>; <span class="comment">//数据管理</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>; <span class="comment">//异步action</span></span><br><span class="line"><span class="keyword">import</span> &#123; persistStore, persistReducer &#125; <span class="keyword">from</span> <span class="string">'redux-persist'</span>; <span class="comment">//数据持久化</span></span><br><span class="line"><span class="keyword">import</span> &#123; AsyncStorage &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>; <span class="comment">//引入本地存储</span></span><br><span class="line"><span class="keyword">import</span> reducers <span class="keyword">from</span> <span class="string">'../reducers'</span>; <span class="comment">//引入combine后的reducer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//追踪action和state变化 http://www.redux.org.cn/docs/advanced/Middleware.html</span></span><br><span class="line"><span class="keyword">const</span> logger = <span class="function"><span class="params">store</span> =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">typeof</span> action === <span class="string">'function'</span>) <span class="built_in">console</span>.log(<span class="string">'dispatching a function'</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">console</span>.log(<span class="string">'dispatching'</span>, action);</span><br><span class="line">	<span class="keyword">let</span> result = next(action);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState());</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//中间件</span></span><br><span class="line"><span class="keyword">let</span> middlewares = [</span><br><span class="line">	logger,</span><br><span class="line">	thunk</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> createAppStore = applyMiddleware(...middlewares)(createStore);</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置redux-persist</span></span><br><span class="line"><span class="keyword">const</span> persistConfig = &#123;</span><br><span class="line">	key: <span class="string">'root'</span>,</span><br><span class="line">	storage: AsyncStorage,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> persistedReducer = persistReducer(persistConfig, reducers)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">	<span class="keyword">let</span> store = createAppStore(persistedReducer)</span><br><span class="line">	<span class="keyword">let</span> persistor = persistStore(store)</span><br><span class="line">	<span class="keyword">return</span> &#123; store, persistor &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>似乎可以实现loading功能<br><figure class="highlight jsx"><figcaption><span>harmony</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PersistGate &#125; <span class="keyword">from</span> <span class="string">'redux-persist/lib/integration/react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> configureStore <span class="keyword">from</span> <span class="string">'./store/index'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; store, persistor &#125; = configureStore();</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Root <span class="keyword">from</span> <span class="string">'./root'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">			&lt;PersistGate loading=&#123;<span class="literal">null</span>&#125; persistor=&#123;persistor&#125;&gt;</span><br><span class="line">				&lt;Root /&gt;</span><br><span class="line">			&lt;<span class="regexp">/PersistGate&gt;</span></span><br><span class="line"><span class="regexp">		&lt;/</span>Provider&gt;</span><br><span class="line">	);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure></p>
<p>还有问题的话，回退到v4的版本 <a href="https://github.com/ninty90/react-native-redux-demo" target="_blank" rel="noopener">参考</a></p>
<h3 id="7-react-native中使用svg"><a href="#7-react-native中使用svg" class="headerlink" title="7.react-native中使用svg"></a>7.react-native中使用svg</h3><p><a href="https://github.com/react-native-community/react-native-svg" target="_blank" rel="noopener">react-native-svg</a><br><a href="https://github.com/vault-development/react-native-svg-uri" target="_blank" rel="noopener">react-native-svg-uri</a></p>
<p><a href="https://www.jianshu.com/p/7db2bc62c5ed" target="_blank" rel="noopener">参考</a></p>
<p>error:<br>(1)react-native 出现 No component found for view with name “RNSVG<em>*</em>”<br><a href="https://www.jianshu.com/p/b51b79ca14e7" target="_blank" rel="noopener">ios</a></p>
<p>(2)No ViewManager defined for class RNSVGPath<br>重启下项目。。</p>
<h3 id="8-react-native中Image的默认图片"><a href="#8-react-native中Image的默认图片" class="headerlink" title="8.react-native中Image的默认图片"></a>8.react-native中Image的默认图片</h3><p>在外层包一层ImageBackground</p>
<h3 id="9-配置react-native-image-crop-picker"><a href="#9-配置react-native-image-crop-picker" class="headerlink" title="9.配置react-native-image-crop-picker"></a>9.配置react-native-image-crop-picker</h3><p><a href="https://github.com/ivpusic/react-native-image-crop-picker" target="_blank" rel="noopener">文档</a><br><a href="https://www.jianshu.com/p/8420b08062c7" target="_blank" rel="noopener">翻译</a><br><a href="http://blog.csdn.net/sinat_17775997/article/details/74908864" target="_blank" rel="noopener">配置</a></p>
<h3 id="10-warning-enableEmptySections"><a href="#10-warning-enableEmptySections" class="headerlink" title="10.warning: enableEmptySections"></a>10.warning: enableEmptySections</h3><p>当升级完react-native的版本时，run-android的时候会报警告<br>Warning:In next release empty section headers will be rendered.<br>In this release you can use ‘enableEmptySections’ flag to render empty section headers<br>解决方法是：<br>在ListView下 加个 enableEmptySections = {true} 就可以解决了</p>
<h3 id="11-react-native-swipe-list-view在tabnavigate里渲染异常"><a href="#11-react-native-swipe-list-view在tabnavigate里渲染异常" class="headerlink" title="11.react-native-swipe-list-view在tabnavigate里渲染异常"></a>11.react-native-swipe-list-view在tabnavigate里渲染异常</h3><p>侧滑部分无法显示，后改用react-native-swipeable<br><a href="https://github.com/jshanson7/react-native-swipeable" target="_blank" rel="noopener">https://github.com/jshanson7/react-native-swipeable</a></p>
<h3 id="12-iOS模拟器突然变成了慢动作？"><a href="#12-iOS模拟器突然变成了慢动作？" class="headerlink" title="12.iOS模拟器突然变成了慢动作？"></a>12.iOS模拟器突然变成了慢动作？</h3><p>iOS模拟器有个slow animation的选项，其快捷键是commant + T，调试过程中容易误碰到。再按一次关闭这个选项即可。</p>
<h3 id="13-常见问题"><a href="#13-常见问题" class="headerlink" title="13.常见问题"></a>13.常见问题</h3><p>常见问题：<a href="http://bbs.reactnative.cn/topic/130/%E6%96%B0%E6%89%8B%E6%8F%90%E9%97%AE%E5%89%8D%E5%85%88%E6%9D%A5%E8%BF%99%E9%87%8C%E7%9C%8B%E7%9C%8B-react-native%E7%9A%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/2" target="_blank" rel="noopener">http://bbs.reactnative.cn/topic/130/%E6%96%B0%E6%89%8B%E6%8F%90%E9%97%AE%E5%89%8D%E5%85%88%E6%9D%A5%E8%BF%99%E9%87%8C%E7%9C%8B%E7%9C%8B-react-native%E7%9A%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/2</a></p>
<h3 id="14-Bridge桥接报错"><a href="#14-Bridge桥接报错" class="headerlink" title="14.Bridge桥接报错"></a>14.Bridge桥接报错</h3><p>可能是属于项目出问题，我这边遇到的是不能用cnpm来安装依赖</p>
<h3 id="15-android打包apk报错"><a href="#15-android打包apk报错" class="headerlink" title="15.android打包apk报错"></a>15.android打包apk报错</h3><p>（1）Lint found fatal errors while assembling a release target.<br>为了解决多个manifest中相同activity重复注册的问题，在build.gradle中增加以下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">	...</span><br><span class="line">	lintOptions &#123;</span><br><span class="line">          checkReleaseBuilds <span class="literal">false</span></span><br><span class="line">          <span class="comment">// Or, if you prefer, you can continue to check for errors in release builds,</span></span><br><span class="line">          <span class="comment">// but continue the build even when errors are found:</span></span><br><span class="line">          abortOnError <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>(2)Execution failed for task ‘:app:bundleReleaseJsAndAssets’.<br>解决办法，命令行先执行 ./gradlew –stop然后执行 ./gradlew assembleRelease</p>
<h3 id="16-注意事项"><a href="#16-注意事项" class="headerlink" title="16.注意事项"></a>16.注意事项</h3><p>（1）安卓下时间格式不要 2018-02-12 12:12:12<br>最好是’/‘格式 time.replace(/-/g,  “/“)</p>
<p>(2)error: Cannot add a child that doesn’t have a YogaNode or parent node<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="keyword">this</span>.state.sign &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> <span class="attr">Color.grey</span>,<span class="attr">textAlign:</span> '<span class="attr">right</span>'&#125;&#125;&gt;</span>&#123;this.state.sign.length&#125;/50<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>发现是在 this.state.sign变空的过程中，Text销毁触发的错误？<br>后改为<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Text style=&#123;&#123;<span class="attr">color</span>: Color.grey,<span class="attr">textAlign</span>: <span class="string">'right'</span>&#125;&#125;&gt;&#123;<span class="keyword">this</span>.state.sign?<span class="keyword">this</span>.state.sign.length: <span class="number">0</span>&#125;/<span class="number">50</span>&lt;<span class="regexp">/Text&gt;</span></span><br></pre></td></tr></table></figure></p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/react/">react</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/react-native/">react-native</a></li></ul></footer></article><link rel="stylesheet" href="/css/menu.css"><script src="/js/jquery.autoMenu.js"></script><div class="autoMenu" id="autoMenu" data-autoMenu></div><section class="reward"> <a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechatImage.jpg" title="微信"><img src="/img/alipayImage.jpg" title="支付宝"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 Cary</div></footer><!--include ../plugins/google.pug--><script src="/js/particles.min.js"></script><script src="/js/particles.other.js"></script><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>